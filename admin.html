<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body{
margin:0;
font-family:'Poppins',sans-serif;
background:#F6F6F6;
display:flex;
justify-content:center;
}

.app{
width:100%;
max-width:480px;
min-height:100vh;
background:#F6F6F6;
}

.header{
background:#6750A4;
color:white;
padding:20px;
border-bottom-left-radius:25px;
border-bottom-right-radius:25px;
box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

.card{
background:white;
margin:15px;
padding:20px;
border-radius:18px;
box-shadow:0 4px 12px rgba(0,0,0,0.08);
}

input{
width:100%;
padding:10px;
margin:6px 0;
border-radius:10px;
border:1px solid #ddd;
}

button{
width:100%;
padding:12px;
border:none;
border-radius:12px;
background:#6750A4;
color:white;
margin-top:8px;
cursor:pointer;
}

.logout{
background:#f44336 !important;
}

table{
width:100%;
border-collapse:collapse;
font-size:12px;
}

th,td{
padding:6px;
border-bottom:1px solid #ddd;
text-align:left;
}
</style>
</head>

<body>
<div class="app">

<div class="header">
<h2><i class="fa fa-user-shield"></i> Admin Dashboard</h2>
</div>

<div id="loginCard" class="card">
<h3>Admin Login</h3>
<input type="text" id="adminUser" placeholder="Username">
<input type="password" id="adminPass" placeholder="Password">
<button onclick="adminLogin()">Login</button>
</div>

<div id="dashboard" style="display:none;">

<div class="card">
<button onclick="loadData()"><i class="fa fa-sync"></i> Refresh Data</button>
<button onclick="exportCSV()"><i class="fa fa-file-csv"></i> Export CSV</button>
<button class="logout" onclick="logout()">Logout</button>
</div>

<div class="card">
<h3>Attendance Records</h3>
<input type="date" id="filterDate" onchange="loadData()">
<input type="text" id="filterEmp" placeholder="Filter by Employee ID" onkeyup="loadData()">
<div style="overflow:auto; max-height:300px;">
<table id="dataTable">
<thead>
<tr>
<th>Date</th>
<th>Name</th>
<th>ID</th>
<th>Dept</th>
<th>In</th>
<th>Out</th>
<th>Hours</th>
<th>Status</th>
<th>Late</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>

</div>

</div>

<script>
const webAppUrl = "https://script.google.com/macros/s/AKfycbyMOR0FXeQ0CNc0QN23XJNC_7-nDoIqmJyQHCrRnxBltzP-W6DgO2oSTvs-urtLyYsy/exec";

const adminUser="admin";
const adminPass="12345";

let allData=[];

function adminLogin(){
const u=document.getElementById("adminUser").value;
const p=document.getElementById("adminPass").value;

if(u===adminUser && p===adminPass){
document.getElementById("loginCard").style.display="none";
document.getElementById("dashboard").style.display="block";
loadData();
}else{
alert("Invalid Login");
}
}

function loadData(){
fetch(webAppUrl)
.then(res=>res.json())
.then(data=>{
allData=data;
renderTable();
});
}

function renderTable(){
const tbody=document.querySelector("#dataTable tbody");
tbody.innerHTML="";

const fDate=document.getElementById("filterDate").value;
const fEmp=document.getElementById("filterEmp").value;

allData.forEach(row=>{
if((!fDate || row.date===fDate) &&
(!fEmp || row.empId.includes(fEmp))){
tbody.innerHTML+=`
<tr>
<td>${row.date}</td>
<td>${row.name}</td>
<td>${row.empId}</td>
<td>${row.department}</td>
<td>${row.checkIn}</td>
<td>${row.checkOut}</td>
<td>${row.hours}</td>
<td>${row.status}</td>
<td>${row.late}</td>
</tr>
`;
}
});
}

function exportCSV(){
let csv="Date,Name,ID,Department,In,Out,Hours,Status,Late\n";
allData.forEach(r=>{
csv+=`${r.date},${r.name},${r.empId},${r.department},${r.checkIn},${r.checkOut},${r.hours},${r.status},${r.late}\n`;
});
const blob=new Blob([csv],{type:"text/csv"});
const url=URL.createObjectURL(blob);
const a=document.createElement("a");
a.href=url;
a.download="attendance.csv";
a.click();
}

function logout(){
location.reload();
}
</script>

</body>
</html>
